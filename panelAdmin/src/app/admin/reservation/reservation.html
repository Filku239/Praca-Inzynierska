<app-admin-navbar></app-admin-navbar>

<div class="reservations-page">
  <h1>Rezerwacje</h1>

  <div class="filters-bar">
    <input
      type="text"
      placeholder="Szukaj po pojeździe..."
      [(ngModel)]="searchTerm"
      (ngModelChange)="onSearchChange($event)"
    />

    <select [(ngModel)]="sortBy" (change)="onSortChange()">
      <option value="none">Brak sortowania</option>
      <option value="cost">Cena</option>
      <option value="duration">Długość wynajmu</option>
    </select>

    <button
      *ngIf="sortBy !== 'none'"
      class="sort-dir"
      (click)="toggleSortDir()"
    >
      {{ sortDir === 'asc' ? '↑' : '↓' }}
    </button>
  </div>

  <p *ngIf="loading">Ładowanie...</p>
  <p *ngIf="error">{{ error }}</p>

  <table *ngIf="!loading && filteredReservations.length">
    <thead>
      <tr>
        <th>Pojazd</th>
        <th>Od</th>
        <th>Do</th>
        <th>Koszt</th>
        <th>Akcje</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let r of filteredReservations">
        <td>{{ r.vehicle?.make }} {{ r.vehicle?.model }}</td>
        <td>{{ r.startDate | date }}</td>
        <td>{{ r.endDate | date }}</td>
        <td>{{ r.cost }} zł</td>
        <td>
          <button (click)="startEdit(r)">Edytuj</button>
          <button (click)="deleteReservation(r)">Usuń</button>
        </td>
      </tr>
    </tbody>
  </table>

  <p *ngIf="!loading && !filteredReservations.length">
    Brak rezerwacji
  </p>

  <div class="modal" *ngIf="editingReservation">
    <div class="modal-content">
      <h2>Edytuj rezerwację</h2>

      <label>
        Od:
        <input type="date" [(ngModel)]="editingReservation.startDate" />
      </label>

      <label>
        Do:
        <input type="date" [(ngModel)]="editingReservation.endDate" />
      </label>

      <div class="modal-actions">
        <button (click)="saveEdit()">Zapisz</button>
        <button (click)="cancelEdit()">Anuluj</button>
      </div>
    </div>
  </div>
</div>
